<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–µ–º–æ–Ω—Ç ‚Äî –û–û–û ¬´–°–ï–†–í–ò–°–¢–†–ê–ù–°–ê–í–¢–û¬ª</title>
  <style>
    :root {
      --text: #333;
      --border: #ccc;
      --bg: #fff;
      --primary: #007bff;
      --danger: #dc3545;
    }
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background: #f8f9fa;
      padding: 10px;
      margin: 0;
      font-size: 14px;
      line-height: 1.5;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
      background: var(--bg);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h2, h3 {
      text-align: center;
      margin: 16px 0 12px;
      color: var(--text);
      font-size: 18px;
    }
    .header-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      font-size: 13px;
      line-height: 1.4;
    }
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin: 12px 0;
    }
    .form-group {
      flex: 1;
      min-width: 200px;
    }
    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 4px;
      color: #444;
    }
    .form-group input, .form-group select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 12px 0;
      font-size: 13px;
    }
    th, td {
      text-align: left;
      padding: 8px 6px;
      border-bottom: 1px solid var(--border);
    }
    thead th {
      font-weight: 600;
      background: #f8f9fa;
    }
    .preview-table th, .preview-table td {
      border: none;
      border-bottom: 1px solid #000;
    }
    .btn {
      padding: 8px 16px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 15px;
      font-weight: bold;
      margin: 5px;
    }
    .btn-save { background: #28a745; }
    .btn-sm { padding: 4px 8px; font-size: 12px; }
    .btn-delete { background: var(--danger); padding: 2px 6px; font-size: 12px; }
    .no-print {
      display: block;
      text-align: center;
      margin-top: 20px;
    }
    @media print {
      .no-print { display: none !important; }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header-row">
    <div>
      –ü–û–°–¢–ê–í–©–ò–ö: –û–±—â–µ—Å—Ç–≤–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é "–°–ï–†–í–ò–°–¢–†–ê–ù–°–ê–í–¢–û"<br>
      –ò–ù–ù 7723905004, –ö–ü–ü 772101001<br>
      111674, –≥. –ú–æ—Å–∫–≤–∞, –≤–Ω.—Ç–µ—Ä.–≥. –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥ –ù–µ–∫—Ä–∞—Å–æ–≤–∫–∞, –ø—Ä-–∫—Ç –ó–∞—â–∏—Ç–Ω–∏–∫–æ–≤ –ú–æ—Å–∫–≤—ã<br>
      —Ç–µ–ª.: +7 (929) 774-88-66, –ö–æ–¥ –ø–æ –û–ö–ü–û 29289257
    </div>
    <div><strong>–î–∞—Ç–∞:</strong> <span id="current-date">‚Äî</span></div>
  </div>

  <h2>–§–æ—Ä–º–∞ –∑–∞—è–≤–∫–∏</h2>

  <div class="form-row">
    <div class="form-group">
      <label>–ù–æ–º–µ—Ä –Ω–∞—Ä—è–¥–∞</label>
      <input type="text" id="order-number" readonly>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>–ö–æ–º–ø–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞</label>
      <input type="text" id="client-company" placeholder="–û–û–û / –ò–ü / –§–ò–û –∫–ª–∏–µ–Ω—Ç–∞">
    </div>
    <div class="form-group">
      <label>–ö–æ–Ω—Ç–∞–∫—Ç</label>
      <input type="text" id="client-contact" placeholder="–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ / —Ç–µ–ª–µ—Ñ–æ–Ω">
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>–ú–∞—Å—Ç–µ—Ä</label>
      <input type="text" id="master-name" placeholder="–ò–≤–∞–Ω–æ–≤ –ò.–ò.">
    </div>
    <div class="form-group">
      <label>–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤—ã–µ–∑–¥–∞</label>
      <input type="text" id="field-agent" placeholder="–ü–µ—Ç—Ä–æ–≤ –ü.–ü.">
    </div>
    <div class="form-group">
      <label>–ú–∞—Ä–∫–∞</label>
      <input type="text" id="vehicle-brand" placeholder="–ì–ê–ó–µ–ª—å, Ford Transit...">
    </div>
    <div class="form-group">
      <label>–ì–æ—Å. –Ω–æ–º–µ—Ä</label>
      <input type="text" id="license-plate" placeholder="–ê111–í–í77">
    </div>
    <div class="form-group">
      <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
      <input type="text" id="client-phone" placeholder="89123456789">
    </div>
    <div class="form-group">
      <label>–ü—Ä–æ–±–µ–≥ (–∫–º)</label>
      <input type="number" id="mileage" placeholder="123456">
    </div>
  </div>

  <h3>–ó–∞—è–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</h3>
  <div class="form-row">
    <input type="text" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" id="work-desc1" style="flex:2;">
    <input type="number" placeholder="–ö–æ–ª-–≤–æ" id="work-qty1" value="1" min="1" style="width:80px;">
    <select id="work-side1" style="width:100px;"><option>‚Äî</option><option>–õ–µ–≤–∞—è</option><option>–ü—Ä–∞–≤–∞—è</option></select>
    <select id="work-pos1" style="width:100px;"><option>‚Äî</option><option>–í–µ—Ä—Ö</option><option>–ù–∏–∑</option></select>
    <button class="btn-sm" onclick="addWorkRow('planned')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
  </div>
  <table id="planned-table">
    <thead><tr><th>‚Ññ</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th><th>–ö–æ–ª-–≤–æ</th><th>–°—Ç–æ—Ä–æ–Ω–∞</th><th>–ü–æ–ª–æ–∂–µ–Ω–∏–µ</th><th></th></tr></thead>
    <tbody></tbody>
  </table>

  <h3>–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</h3>
  <div class="form-row">
    <input type="text" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" id="work-desc2" style="flex:2;">
    <input type="number" placeholder="–ö–æ–ª-–≤–æ" id="work-qty2" value="1" min="1" style="width:80px;">
    <select id="work-side2" style="width:100px;"><option>‚Äî</option><option>–õ–µ–≤–∞—è</option><option>–ü—Ä–∞–≤–∞—è</option></select>
    <select id="work-pos2" style="width:100px;"><option>‚Äî</option><option>–í–µ—Ä—Ö</option><option>–ù–∏–∑</option></select>
    <input type="number" placeholder="–¶–µ–Ω–∞" id="work-price2" style="width:100px;">
    <button class="btn-sm" onclick="addWorkRow('actual')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
  </div>
  <table id="actual-table">
    <thead><tr><th>‚Ññ</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th><th>–ö–æ–ª-–≤–æ</th><th>–°—Ç–æ—Ä–æ–Ω–∞</th><th>–ü–æ–ª–æ–∂–µ–Ω–∏–µ</th><th>–¶–µ–Ω–∞</th><th>–°—É–º–º–∞</th><th></th></tr></thead>
    <tbody></tbody>
  </table>

  <h3>–ó–∞–ø—á–∞—Å—Ç–∏</h3>
  <div class="form-row">
    <input type="text" placeholder="–ê—Ä—Ç–∏–∫—É–ª" id="part-art" style="width:120px;">
    <input type="text" placeholder="–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ" id="part-name" style="flex:2;">
    <input type="number" placeholder="–ö–æ–ª-–≤–æ" id="part-qty" value="1" min="1" style="width:80px;">
    <input type="number" placeholder="–¶–µ–Ω–∞" id="part-price" style="width:100px;">
    <button class="btn-sm" onclick="addPartRow()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
  </div>
  <table id="parts-table">
    <thead><tr><th>‚Ññ</th><th>–ê—Ä—Ç–∏–∫—É–ª</th><th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th><th>–ö–æ–ª-–≤–æ</th><th>–¶–µ–Ω–∞</th><th>–°—É–º–º–∞</th><th></th></tr></thead>
    <tbody></tbody>
  </table>

  <div class="no-print" style="text-align:center; margin-top:20px;">
    <button class="btn" onclick="printClaim()">üìÑ –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –∑–∞—è–≤–∫—É</button>
    <button class="btn" style="background:#28a745;" onclick="printOrder()">üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –∑–∞–∫–∞–∑-–Ω–∞—Ä—è–¥</button>
    <button class="btn btn-save" onclick="exportTo1C()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV –¥–ª—è 1–°</button>
  </div>
</div>

<script>
  let workIndex = 1, actualIndex = 1, partIndex = 1;

  (() => {
    const now = new Date();
    const d = `${String(now.getDate()).padStart(2, '0')}.${String(now.getMonth() + 1).padStart(2, '0')}.${now.getFullYear()}`;
    document.getElementById('current-date').textContent = d;
    document.getElementById('order-number').value = `–°–¢–ê-${now.getFullYear()}-${String(Date.now() % 1000).padStart(3, '0')}`;
  })();

  // === –î–û–ë–ê–í–õ–ï–ù–ò–ï / –£–î–ê–õ–ï–ù–ò–ï –°–¢–†–û–ö ===
  function addWorkRow(type) {
    const isPlanned = type === 'planned';
    const desc = (isPlanned ? document.getElementById('work-desc1') : document.getElementById('work-desc2')).value || '‚Äî';
    const qty = (isPlanned ? document.getElementById('work-qty1') : document.getElementById('work-qty2')).value || 1;
    const side = (isPlanned ? document.getElementById('work-side1') : document.getElementById('work-side2')).value || '‚Äî';
    const pos = (isPlanned ? document.getElementById('work-pos1') : document.getElementById('work-pos2')).value || '‚Äî';
    const price = isPlanned ? null : parseFloat(document.getElementById('work-price2').value) || 0;
    const total = isPlanned ? null : qty * price;
    const tbody = document.querySelector(`#${type}-table tbody`);
    const row = tbody.insertRow();
    const idx = isPlanned ? workIndex++ : actualIndex++;
    const cells = [
      { t: idx },
      { t: desc },
      { t: qty },
      { t: side },
      { t: pos },
      ...(isPlanned ? [] : [{ t: price }, { t: total }]),
      { h: `<button class="btn-delete" onclick="removeRow(this)">‚úï</button>` }
    ];
    cells.forEach(c => {
      const td = document.createElement('td');
      td[c.h ? 'innerHTML' : 'textContent'] = c.t || c.h;
      row.appendChild(td);
    });
  }

  function addPartRow() {
    const art = document.getElementById('part-art').value || '‚Äî';
    const name = document.getElementById('part-name').value || '‚Äî';
    const qty = document.getElementById('part-qty').value || 1;
    const price = parseFloat(document.getElementById('part-price').value) || 0;
    const total = qty * price;
    const tbody = document.querySelector('#parts-table tbody');
    const row = tbody.insertRow();
    const idx = partIndex++;
    const cells = [
      { t: idx }, { t: art }, { t: name }, { t: qty }, { t: price }, { t: total },
      { h: `<button class="btn-delete" onclick="removeRow(this)">‚úï</button>` }
    ];
    cells.forEach(c => {
      const td = document.createElement('td');
      td[c.h ? 'innerHTML' : 'textContent'] = c.t || c.h;
      row.appendChild(td);
    });
  }

  function removeRow(btn) { btn.closest('tr').remove(); }

  // === –ü–ï–ß–ê–¢–¨ –ó–ê–Ø–í–ö–ò ===
  function printClaim() {
    const d = document.getElementById('current-date').textContent;
    const n = document.getElementById('order-number').value;
    const c = document.getElementById('client-company').value || '‚Äî';
    const ct = document.getElementById('client-contact').value || '‚Äî';
    const m = document.getElementById('master-name').value || '‚Äî';
    const a = document.getElementById('field-agent').value || '‚Äî';
    const b = document.getElementById('vehicle-brand').value || '‚Äî';
    const p = document.getElementById('license-plate').value || '‚Äî';
    const ph = document.getElementById('client-phone').value || '‚Äî';
    const mi = (document.getElementById('mileage').value || '‚Äî') + ' –∫–º';

    let html = `
      <div style="font-family:Arial,sans-serif; padding:20px;">
        <div style="display:flex; justify-content:space-between; margin-bottom:12px; font-size:13px;">
          <div><strong>–ü–û–°–¢–ê–í–©–ò–ö:</strong> –û–û–û "–°–ï–†–í–ò–°–¢–†–ê–ù–°–ê–í–¢–û"<br>–ò–ù–ù 7723905004, –ö–ü–ü 772101001<br>111674, –≥. –ú–æ—Å–∫–≤–∞, –ø—Ä-–∫—Ç –ó–∞—â–∏—Ç–Ω–∏–∫–æ–≤ –ú–æ—Å–∫–≤—ã<br>—Ç–µ–ª.: +7 (929) 774-88-66</div>
          <div><strong>–î–∞—Ç–∞:</strong> ${d}</div>
        </div>
        <div style="text-align:center; font-weight:bold; margin:12px 0; font-size:18px;">–ó–ê–Ø–í–ö–ê –ù–ê –†–ï–ú–û–ù–¢</div>

        <table style="width:100%; border-collapse:collapse; font-size:13px; margin-bottom:16px;">
          <tr><td style="padding:4px;">–ù–æ–º–µ—Ä –Ω–∞—Ä—è–¥–∞: ${n}</td><td style="padding:4px;">–î–∞—Ç–∞: ${d}</td></tr>
          <tr><td style="padding:4px;">–ö–æ–º–ø–∞–Ω–∏—è: ${c}</td><td style="padding:4px;">–ö–æ–Ω—Ç–∞–∫—Ç: ${ct}</td></tr>
          <tr><td style="padding:4px;">–ú–∞—Å—Ç–µ—Ä: ${m}</td><td style="padding:4px;">–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤—ã–µ–∑–¥–∞: ${a}</td></tr>
          <tr><td style="padding:4px;">–ú–∞—Ä–∫–∞: ${b}</td><td style="padding:4px;">–ì–æ—Å. –Ω–æ–º–µ—Ä: ${p}</td></tr>
          <tr><td style="padding:4px;">–¢–µ–ª–µ—Ñ–æ–Ω: ${ph}</td><td style="padding:4px;">–ü—Ä–æ–±–µ–≥: ${mi}</td></tr>
        </table>
    `;

    html += createTableHTML('–ó–∞—è–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã', 'planned-table', false);
    html += createTableHTML('–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã', 'actual-table', true);
    html += createTableHTML('–ó–∞–ø—á–∞—Å—Ç–∏', 'parts-table', true, true);
    html += '</div>';

    printWindow(html);
  }

  // === –ü–ï–ß–ê–¢–¨ –ó–ê–ö–ê–ó-–ù–ê–†–Ø–î–ê ===
  function printOrder() {
    const d = document.getElementById('current-date').textContent;
    const n = document.getElementById('order-number').value;
    let html = `
      <div style="font-family:Arial,sans-serif; padding:20px;">
        <div style="display:flex; justify-content:space-between; margin-bottom:12px; font-size:13px;">
          <div><strong>–ü–û–°–¢–ê–í–©–ò–ö:</strong> –û–û–û "–°–ï–†–í–ò–°–¢–†–ê–ù–°–ê–í–¢–û"<br>–ò–ù–ù 7723905004, –ö–ü–ü 772101001<br>111674, –≥. –ú–æ—Å–∫–≤–∞, –ø—Ä-–∫—Ç –ó–∞—â–∏—Ç–Ω–∏–∫–æ–≤ –ú–æ—Å–∫–≤—ã<br>—Ç–µ–ª.: +7 (929) 774-88-66</div>
          <div><strong>–î–∞—Ç–∞:</strong> ${d}</div>
        </div>
        <div style="text-align:center; font-weight:bold; margin:12px 0; font-size:18px;">–ó–ê–ö–ê–ó-–ù–ê–†–Ø–î ‚Ññ${n}</div>
    `;

    html += createTableHTML('–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã', 'actual-table', true);
    html += createTableHTML('–ó–∞–ø—á–∞—Å—Ç–∏', 'parts-table', true, true);
    html += '</div>';

    printWindow(html);
  }

  function createTableHTML(title, tableId, hasPrice, isPart = false) {
    let html = `<h3 style="margin:12px 0; font-size:15px;">${title}</h3><table style="width:100%; border-collapse:collapse;">`;
    const headers = isPart ? ['‚Ññ','–ê—Ä—Ç–∏–∫—É–ª','–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ','–ö–æ–ª-–≤–æ','–¶–µ–Ω–∞','–°—É–º–º–∞']
                 : hasPrice ? ['‚Ññ','–û–ø–∏—Å–∞–Ω–∏–µ','–ö–æ–ª-–≤–æ','–°—Ç–æ—Ä–æ–Ω–∞','–ü–æ–ª–æ–∂–µ–Ω–∏–µ','–¶–µ–Ω–∞','–°—É–º–º–∞']
                 : ['‚Ññ','–û–ø–∏—Å–∞–Ω–∏–µ','–ö–æ–ª-–≤–æ','–°—Ç–æ—Ä–æ–Ω–∞','–ü–æ–ª–æ–∂–µ–Ω–∏–µ'];
    html += '<thead><tr>';
    headers.forEach(h => html += `<th style="text-align:left; padding:6px; border-bottom:1px solid #000;">${h}</th>`);
    html += '</tr></thead><tbody>';

    const rows = tableId === 'planned-table' ? document.querySelectorAll('#planned-table tbody tr')
               : tableId === 'actual-table' ? document.querySelectorAll('#actual-table tbody tr')
               : document.querySelectorAll('#parts-table tbody tr');

    rows.forEach((row, i) => {
      html += '<tr>';
      if (isPart) {
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${i+1}</td>`;
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${row.cells[1].textContent}</td>`;
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${row.cells[2].textContent}</td>`;
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${row.cells[3].textContent}</td>`;
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${row.cells[4].textContent}</td>`;
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${row.cells[5].textContent}</td>`;
      } else if (hasPrice) {
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${i+1}</td>`;
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${row.cells[1].textContent}</td>`;
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${row.cells[2].textContent}</td>`;
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${row.cells[3].textContent}</td>`;
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${row.cells[4].textContent}</td>`;
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${row.cells[5].textContent}</td>`;
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${row.cells[6].textContent}</td>`;
      } else {
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${i+1}</td>`;
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${row.cells[1].textContent}</td>`;
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${row.cells[2].textContent}</td>`;
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${row.cells[3].textContent}</td>`;
        html += `<td style="padding:6px; border-bottom:1px solid #000;">${row.cells[4].textContent}</td>`;
      }
      html += '</tr>';
    });
    html += '</tbody></table>';
    return html;
  }

  // === –ë–ï–ó–û–ü–ê–°–ù–ê–Ø –ü–ï–ß–ê–¢–¨ ===
  function printWindow(html) {
    const win = window.open('', '_blank');
    if (!win) {
      alert('–†–∞–∑—Ä–µ—à–∏—Ç–µ –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –æ–∫–Ω–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏.');
      return;
    }
    win.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>–ü–µ—á–∞—Ç—å</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 20px; }
          table { width: 100%; border-collapse: collapse; margin: 10px 0; }
          th, td { text-align: left; padding: 6px; border-bottom: 1px solid #000; }
        </style>
      </head>
      <body>
        ${html}
      </body>
      </html>
    `);
    win.document.close();
    win.focus();
    win.onload = () => {
      try { win.print(); } catch (e) { alert('–û—à–∏–±–∫–∞ –ø–µ—á–∞—Ç–∏'); }
    };
  }

  // === –≠–ö–°–ü–û–†–¢ –í CSV –î–õ–Ø 1–° ===
  function exportTo1C() {
    const order = document.getElementById('order-number').value;
    const date = document.getElementById('current-date').textContent;
    const company = document.getElementById('client-company').value || '';
    const contact = document.getElementById('client-contact').value || '';
    const master = document.getElementById('master-name').value || '';
    const agent = document.getElementById('field-agent').value || '';
    const brand = document.getElementById('vehicle-brand').value || '';
    const plate = document.getElementById('license-plate').value || '';
    const phone = document.getElementById('client-phone').value || '';
    const mileage = document.getElementById('mileage').value || '';

    let lines = [];
    document.querySelectorAll('#planned-table tbody tr').forEach(row => {
      lines.push([order,date,company,contact,master,agent,brand,plate,phone,mileage,'–ó–∞—è–≤–ª–µ–Ω–Ω–∞—è',row.cells[1].textContent,row.cells[2].textContent,row.cells[3].textContent,row.cells[4].textContent,'','','']);
    });
    document.querySelectorAll('#actual-table tbody tr').forEach(row => {
      lines.push([order,date,company,contact,master,agent,brand,plate,phone,mileage,'–í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è',row.cells[1].textContent,row.cells[2].textContent,row.cells[3].textContent,row.cells[4].textContent,'',row.cells[5].textContent,row.cells[6].textContent]);
    });
    document.querySelectorAll('#parts-table tbody tr').forEach(row => {
      lines.push([order,date,company,contact,master,agent,brand,plate,phone,mileage,'–ó–∞–ø—á–∞—Å—Ç—å',row.cells[2].textContent,row.cells[3].textContent,'','',row.cells[1].textContent,row.cells[4].textContent,row.cells[5].textContent]);
    });

    const header = ['–ù–æ–º–µ—Ä –Ω–∞—Ä—è–¥–∞','–î–∞—Ç–∞','–ö–æ–º–ø–∞–Ω–∏—è','–ö–æ–Ω—Ç–∞–∫—Ç','–ú–∞—Å—Ç–µ—Ä','–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤—ã–µ–∑–¥–∞','–ú–∞—Ä–∫–∞','–ì–æ—Å. –Ω–æ–º–µ—Ä','–¢–µ–ª–µ—Ñ–æ–Ω','–ü—Ä–æ–±–µ–≥ (–∫–º)','–¢–∏–ø —Å—Ç—Ä–æ–∫–∏','–û–ø–∏—Å–∞–Ω–∏–µ/–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ','–ö–æ–ª-–≤–æ','–°—Ç–æ—Ä–æ–Ω–∞','–ü–æ–ª–æ–∂–µ–Ω–∏–µ','–ê—Ä—Ç–∏–∫—É–ª','–¶–µ–Ω–∞','–°—É–º–º–∞'];
    let csv = header.map(cell => `"${cell.replace(/"/g,'""')}"`).join(';') + '\n';
    lines.forEach(line => csv += line.map(cell => `"${(cell||'').toString().replace(/"/g,'""')}"`).join(';') + '\n');

    const bom = '\uFEFF';
    const blob = new Blob([bom + csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `zayavka_1c_${order}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }
</script>

</body>
</html>
